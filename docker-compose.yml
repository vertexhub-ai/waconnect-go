version: '3.8'

services:
  waconnect:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: waconnect-go
    restart: unless-stopped
    ports:
      - "3200:3200"
    volumes:
      - ./sessions:/app/sessions
    environment:
      - PORT=3200
      - API_KEY=${API_KEY:-dev-api-key}
      - SESSION_DIR=/app/sessions
      - DASHBOARD_USER=${DASHBOARD_USER:-admin}
      - DASHBOARD_PASS=${DASHBOARD_PASS:-waconnect123}
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:3200/health"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 5s
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.waconnect.rule=Host(`waconnect.example.com`)"

# Optional: n8n for workflow automation
#  n8n:
#    image: n8nio/n8n
#    container_name: n8n
#    restart: unless-stopped
#    ports:
#      - "5678:5678"
#    environment:
#      - N8N_BASIC_AUTH_ACTIVE=true
#      - N8N_BASIC_AUTH_USER=admin
#      - N8N_BASIC_AUTH_PASSWORD=n8n123
#    volumes:
#      - n8n_data:/home/node/.n8n

volumes:
  sessions:
#  n8n_data:
